<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<meta http-equiv="content-type" content="text/html;charset=utf-8" />

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<meta name="author" content="mironcoder" />
	<meta name="email" content="mironcoder@gmail.com" />
	<meta name="profile" content="https://themeforest.net/user/mironcoder" />
	<meta name="template" content="greeny" />
	<meta name="title" content="greeny - Ecommerce Food Store HTML Template" />
	<meta name="keywords"
		content="organic, food, shop, ecommerce, store, html, bootstrap, template, agriculture, vegetables, products, farm, grocery, natural, online" />
	<title>Nông sản xanh Greeny</title>
	<link rel="icon" href="images/favicon.png" />
	<link rel="stylesheet" href="fonts/flaticon/flaticon.css" />
	<link rel="stylesheet" href="fonts/icofont/icofont.min.css" />
	<link rel="stylesheet" href="fonts/fontawesome/fontawesome.min.css" />
	<link rel="stylesheet" href="vendor/venobox/venobox.min.css" />
	<link rel="stylesheet" href="vendor/slickslider/slick.min.css" />
	<link rel="stylesheet" href="vendor/niceselect/nice-select.min.css" />
	<link rel="stylesheet" href="vendor/bootstrap/bootstrap.min.css" />
	<link rel="stylesheet" href="css/main.css" />
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
	<df-messenger
		intent="WELCOME"
		chat-title="Greeny_Shop_Chat_Bot"
		agent-id="27e88f1b-7cfe-4799-8dea-295efe06a527"
		language-code="vi"
	></df-messenger>
	<script>
		$(document).ready(function () {
			$('.product-add1').click(function (event) {
				event.preventDefault();

				var productId = $(this).data('product-id');

				$.ajax({
					type: "GET",
					url: "/api/carts",
					dataType: 'json',
					success: function (response) {
						let isDuplicate = response.find((item) => item.product.productId === productId);
						if (!isDuplicate) {
							let totalCartItems = Number($('sup[id="totalCartItems"]').text());
							if (!totalCartItems) {
								totalCartItems = 0;
							}
							$('sup[id="totalCartItems"]').text(totalCartItems + 1);
						}
					},
					error: function () { }
				});

				$.ajax({
					type: "GET",
					url: "/addToCart",
					data: {
						productId: productId
					},
					success: function () { },
					error: function () { }
				});
			});

			function addToCart() {
				$.ajax({
					type: "GET",
					url: "/api/carts",
					dataType: 'json',
					success: function (response) {
						if (response.length > 0) {
							$('.cart-list').text('');
							response.forEach((item) => {
								let cartItem = `<li class="cart-item">
                                              <div class="cart-media">
                                                  <a href="/productDetail?id=${item.product.productId}">
                                                      <img src="/loadImage?imageName=${item.product.productImage}" alt="product">
                                                  </a>
                                              </div>
                                              <div class="cart-info-group">
                                                  <div class="cart-info">
                                                      <h6>
                                                          <label>Tên sản phẩm :</label>
                                                          <a href="/productDetail?id=${item.product.productId}" style="color: #119744">${item.product.productName}</a>
                                                      </h6>
                                                      <label>Đơn giá :</label>
                                                      <p>${item.product.price} đ</p>
                                                  </div>
                                                  <div class="cart-action-group">
                                                      <div class="product-action">
                                                          <label>Số lượng :</label>
                                                          <button class="btn-num-product-down" data-id="${item.id}" data-quantity="-1">
                                                              <div class="cl8 hov-btn3 trans-04 flex-c-m">
                                                                  <i class="fa fa-minus" style="width: 20px; height: 20px; font-size: 10px; line-height: 20px; border-radius: 5px"></i>
                                                              </div>
                                                          </button>
                                                          <input class="action-input" title="Quantity Number" type="text" name="quantity" value="${item.quantity}" style="width: 25px; height: 25px;">
                                                          <button class="btn-num-product-up" data-id="${item.id}" data-quantity="1">
                                                              <div class="cl8 hov-btn3 trans-04 flex-c-m">
                                                                  <i class="fa fa-plus" style="width: 20px; height: 20px; font-size: 10px; line-height: 20px; border-radius: 5px"></i>
                                                              </div>
                                                          </button>
                                                      </div>
                                                      <h6>${item.totalPrice} đ</h6>
                                                  </div>
                                              </div>
                                          </li>`;
								$('.cart-list').append(cartItem);
							});

							// Gán sự kiện click cho các nút thay đổi số lượng
							// Lưu ý chỉ gán sự kiện một lần cho các button
							$('.btn-num-product-down').off('click').on('click', function () {
								const itemId = $(this).data('id');         // Lấy id từ data-id
								const newQuantity = $(this).data('quantity');  // Lấy quantity từ data-quantity
								console.log('itemId:', itemId, 'newQuantity:', newQuantity);  // Kiểm tra lại giá trị
								updateCart(itemId, newQuantity);          // Gọi hàm updateCart
							});

							$('.btn-num-product-up').off('click').on('click', function () {
								const itemId = $(this).data('id');         // Lấy id từ data-id
								const newQuantity = $(this).data('quantity');  // Lấy quantity từ data-quantity
								console.log('itemId:', itemId, 'newQuantity:', newQuantity);  // Kiểm tra lại giá trị
								updateCart(itemId, newQuantity);          // Gọi hàm updateCart
							});
						}
					},
					error: function () {
						alert("Cập nhật giỏ hàng thất bại!");
					}
				});
			}

			function updateCart(itemId, quantity) {
				console.log('Update cart with:', itemId);  // In ra để kiểm tra
				$.ajax({
					type: "GET",
					url: "/update-cart",  // Đảm bảo đường dẫn là chính xác
					data: {               // Truyền tham số qua query string
						id: itemId,         // Tham số 'id'
						quantity: quantity  // Tham số 'quantity'
					},
					success: function (response) {
						console.log("Cart updated successfully:", response);
						addToCart();  // Reload giỏ hàng sau khi cập nhật thành công
					},
					error: function (xhr, status, error) {
						console.error('Cập nhật giỏ hàng thất bại:', status, error);
						alert("Cập nhật giỏ hàng thất bại!");
					}
				});
			}

			$('#cart-icon').click(function (event) {
				$.ajax({
					type: "GET",
					url: "/api/total-cart-items",
					dataType: 'json',
					success: function (response) {
						$('#total-cart-items').text('(' + response + ')');
						if (Number(response) > 0) {
							document.getElementById("some-item-1").style.setProperty('display', 'block', 'important');
							document.getElementById("some-item-2").style.setProperty('display', 'block', 'important');
							document.getElementById("nothing-item").style.setProperty('display', 'none', 'important');
							addToCart();
						} else {
							document.getElementById("nothing-item").style.setProperty('display', 'block', 'important');
							document.getElementById("some-item-1").style.setProperty('display', 'none', 'important');
							document.getElementById("some-item-2").style.setProperty('display', 'none', 'important');
						}
					},
					error: function () { }
				});
			});
		});
	</script>
	<link rel="stylesheet" href="css/index.css" />
</head>

<body>

	<!--************************************
				Header Start
		*************************************-->
	<header th:replace="~{/web/fragments/header :: header}"></header>
	<!--************************************
				Header End
		*************************************-->

	<section class="home-index-slider slider-arrow slider-dots">
		<div class="banner-part banner-1">
			<div class="container">
				<div class="row align-items-center">
					<div class="col-md-6 col-lg-6">
						<div class="banner-content">
							<h1>Giao hàng tận nhà miễn phí trong vòng 24 giờ ngay bây
								giờ.</h1>
							<p>Giao hàng nhanh chóng, đảm bảo chất lượng sản phẩm, giữ được độ tươi ngon tới tay khách
								hàng.
								Chúng tôi tự tin và cam kết có thể làm hài lòng được những khác hàng khó tính nhất.</p>
							<div class="banner-btn">
								<a class="btn btn-inline" th:href="@{/products}">
									<i class="fas fa-shopping-basket"></i>
									<span>mua sắm ngay bây giờ</span>
								</a>
								<!-- <a class="btn btn-outline" href="javascript:void(0);">
									<i class="icofont-sale-discount"></i>
									<span>nhận đề nghị</span>
								</a> -->
							</div>
						</div>
					</div>
					<div class="col-md-6 col-lg-6">
						<div class="banner-img">
							<img src="images/home/index/01.png" alt="index" />
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="banner-part banner-2">
			<div class="container">
				<div class="row align-items-center">
					<div class="col-md-6 col-lg-6">
						<div class="banner-img">
							<img src="images/home/index/02.png" alt="index" />
						</div>
					</div>
					<div class="col-md-6 col-lg-6">
						<div class="banner-content">
							<h1>Giao hàng tận nhà miễn phí trong vòng 24 giờ ngay bây
								giờ.</h1>
							<p>Giao hàng nhanh chóng, đảm bảo chất lượng sản phẩm, giữ được độ tươi ngon tới tay khách
								hàng.
								Chúng tôi tự tin và cam kết có thể làm hài lòng được những khác hàng khó tính nhất.</p>
							<div class="banner-btn">
								<a class="btn btn-inline" th:href="@{/products}">
									<i class="fas fa-shopping-basket"></i>
									<span>mua sắm ngay bây giờ</span>
								</a>
								<!-- <a class="btn btn-outline" href="javascript:void(0);">
									<i class="icofont-sale-discount"></i>
									<span>nhận đề nghị</span>
								</a> -->
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<section class="section suggest-part">
		<div class="container">
			<ul class="suggest-slider slider-arrow">
				<li th:each="item : ${coutnProductByCategory}">
					<a class="suggest-card" th:href="@{/productByCategory(id=${item[0]})}">
						<img src="images/suggest/02.jpg" alt="suggest" />
						<h5>
							[[${item[1]}]] <span>số lượng : [[${item[2]}]] </span>
						</h5>
					</a>
				</li>
			</ul>
		</div>
	</section>
	<section class="section recent-part">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="section-heading">
						<h2>Mặt hàng bán chạy</h2>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<ul class="new-slider slider-arrow">
						<li th:each="item : ${bestSaleProduct20}">
							<div class="product-card">
								<div class="product-media">
									<div class="product-label">
										<label class="label-text new">bán chạy</label>
										<!-- <label class="label-text sale">- [[${item.discount + '%'}]]</label> -->
									</div>
									<button class="product-wish wish">
										<i class="fas fa-heart"></i>
									</button>
									<a class="product-image" th:href="@{/productDetail(id=${item.productId})}">
										<img th:src="@{'/loadImage?imageName='+${item.productImage}}" alt="product" />
									</a>
									<div class="product-widget">

										<a title="Video sản phẩm" href="https://youtu.be/9xzcVxSBbG8"
											class="venobox fas fa-play" data-autoplay="true" data-vbtype="video">
										</a>
										<a title="Chi tiết sản phẩm" th:href="@{/productDetail(id=${item.productId})}"
											class="fas fa-eye">
										</a>
									</div>
								</div>
								<div class="product-content">
									<div class="product-rating" th:attr="data-evaluate=${item.evaluate}">
										<!-- logic hiển thị sao đánh giá -->
										<i th:each="starIndex : ${#numbers.sequence(1, 5)}"
											th:class="${starIndex <= item.evaluate} ? 'active icofont-star' : 'icofont-star'"></i>
									</div>

									<h6 class="product-name">
										<a th:href="@{/productDetail(id=${item.productId})}">[[${item.productName}]]</a>
									</h6>
									<h6 class="product-price">
										<!-- <del>[[${#numbers.formatDecimal(item.price, 1, 'DEFAULT', 0, 'DEFAULT')}+' đ']]</del> -->
										<span>[[${#numbers.formatDecimal(item.price, 1, 'DEFAULT', 0, 'DEFAULT')}+'
											đ']]<small>/kg</small></span>
									</h6>
									<a class="product-add1" th:attr="data-product-id=${item.productId}" href="#"
										title="Thêm Giỏ Hàng">
										<i class="fas fa-shopping-basket"></i><span>Thêm giỏ hàng</span>
									</a>

								</div>
							</div>
						</li>
					</ul>
				</div>

			</div>
			<div class="row">
				<div class="col-lg-12">
					<div class="section-btn-25">
						<a th:href="@{/products}" class="btn btn-outline"><i class="fas fa-eye"></i><span>xem
								thêm</span></a>
					</div>
				</div>
			</div>
		</div>
	</section>
	<div class="section promo-part">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="promo-img">
						<a href="javascript:void(0);"><img src="images/promo/home/03.jpg" alt="promo" /></a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<section class="section feature-part">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="section-heading">
						<h2>Mặt hàng nổi bật</h2>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<ul class="new-slider slider-arrow">
						<li th:each="item : ${bestSaleProduct20}">
							<div class="product-card">
								<div class="product-media">
									<div class="product-label">
										<label class="label-text feat">nổi bật</label>
										<!-- <label class="label-text sale">- [[${item.discount + '%'}]]</label> -->
									</div>
									<button class="product-wish wish">
										<i class="fas fa-heart"></i>
									</button>
									<a class="product-image" th:href="@{/productDetail(id=${item.productId})}">
										<img th:src="@{'/loadImage?imageName='+${item.productImage}}" alt="product" />
									</a>
									<div class="product-widget">

										<a title="Product Video" href="https://youtu.be/9xzcVxSBbG8"
											class="venobox fas fa-play" data-autoplay="true" data-vbtype="video">
										</a>
										<a title="Chi tiết sản phẩm" th:href="@{/productDetail(id=${item.productId})}"
											class="fas fa-eye">
										</a>
									</div>
								</div>
								<div class="product-content">
									<div class="product-rating" th:attr="data-evaluate=${item.evaluate}">
										<!-- logic hiển thị sao đánh giá -->
										<i th:each="starIndex : ${#numbers.sequence(1, 5)}"
											th:class="${starIndex <= item.evaluate} ? 'active icofont-star' : 'icofont-star'"></i>
									</div>

									<h6 class="product-name">
										<a th:href="@{/productDetail(id=${item.productId})}">[[${item.productName}]]</a>
									</h6>
									<h6 class="product-price">
										<!-- <del>[[${#numbers.formatDecimal(item.price, 1, 'DEFAULT', 0, 'DEFAULT')}+' đ']]</del> -->
										<span>[[${#numbers.formatDecimal(item.price, 1, 'DEFAULT', 0, 'DEFAULT')}+'
											đ']]<small>/kg</small></span>
									</h6>
									<a class="product-add1" th:attr="data-product-id=${item.productId}" href="#"
										title="Thêm Giỏ Hàng">
										<i class="fas fa-shopping-basket"></i><span>Thêm giỏ hàng</span>
									</a>

								</div>
							</div>
						</li>
					</ul>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<div class="section-btn-25">
						<a th:href="@{/products}" class="btn btn-outline"><i class="fas fa-eye"></i><span>xem
								thêm</span></a>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- <section class="section countdown-part">
		<div class="container">
			<div class="row align-items-center">
				<div class="col-lg-6 mx-auto">
					<div class="countdown-content">
						<h3>ƯU ĐÃI GIẢM GIÁ ĐẶC BIỆT CHO CÁC MẶT HÀNG</h3>
						<p>Reprehenderit sed quod autem molestiae aut modi minus
							veritatis iste dolorum suscipit quis voluptatum fugiat mollitia
							quia minima</p>
						<div class="countdown countdown-clock" data-countdown="2022/12/22">
							<span class="countdown-time"><span>00</span><small>days</small></span><span
								class="countdown-time"><span>00</span><small>hours</small></span><span
								class="countdown-time"><span>00</span><small>minutes</small></span><span
								class="countdown-time"><span>00</span><small>seconds</small></span>
						</div>
						<a th:href="@{/products}" class="btn btn-inline"><i class="fas fa-shopping-basket"></i><span>Mua
								sắm ngay bây
								giờ</span></a>
					</div>
				</div>
				<div class="col-lg-1"></div>
				<div class="col-lg-5">
					<div class="countdown-img">
						<img src="images/countdown.png" alt="countdown" />
						<div class="countdown-off">
							<span>20%</span><span>off</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section> -->
	<section class="section newitem-part">
		<div class="container">
			<div class="row">
				<div class="col">
					<div class="section-heading">
						<h2>Mặt hàng mới về</h2>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<ul class="new-slider slider-arrow">
						<li th:each="item : ${productList}">
							<div class="product-card">
								<div class="product-media">
									<div class="product-label">
										<label class="label-text new">mới</label>
										<!-- <label class="label-text sale">- [[${item.discount + '%'}]]</label> -->
									</div>
									<button class="product-wish wish">
										<i class="fas fa-heart"></i>
									</button>
									<a class="product-image" th:href="@{/productDetail(id=${item.productId})}">
										<img th:src="@{'/loadImage?imageName='+${item.productImage}}" alt="product" />
									</a>
									<div class="product-widget">

										<a title="Product Video" href="https://youtu.be/9xzcVxSBbG8"
											class="venobox fas fa-play" data-autoplay="true" data-vbtype="video">
										</a>
										<a title="Chi tiết sản phẩm" th:href="@{/productDetail(id=${item.productId})}"
											class="fas fa-eye">
										</a>
									</div>
								</div>
								<div class="product-content">
									<div class="product-rating" th:attr="data-evaluate=${item.evaluate}">
										<!-- logic hiển thị sao đánh giá -->
										<i th:each="starIndex : ${#numbers.sequence(1, 5)}"
											th:class="${starIndex <= item.evaluate} ? 'active icofont-star' : 'icofont-star'"></i>
									</div>
									<h6 class="product-name">
										<a th:href="@{/productDetail(id=${item.productId})}">[[${item.productName}]]</a>
									</h6>
									<h6 class="product-price">
										<!-- <del>[[${#numbers.formatDecimal(item.price, 1, 'DEFAULT', 0, 'DEFAULT')}+' đ']]</del> -->
										<span>[[${#numbers.formatDecimal(item.price, 1, 'DEFAULT', 0, 'DEFAULT')}+'
											đ']]<small>/kg</small></span>
									</h6>
									<a class="product-add1" th:attr="data-product-id=${item.productId}" href="#"
										title="Thêm Giỏ Hàng">
										<i class="fas fa-shopping-basket"></i><span>Thêm giỏ hàng</span>
									</a>

								</div>
							</div>
						</li>
					</ul>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<div class="section-btn-25">
						<a th:href="@{/products}" class="btn btn-outline"><i class="fas fa-eye"></i><span>xem
								thêm</span></a>
					</div>
				</div>
			</div>
		</div>
	</section>
	<div class="section promo-part">
		<div class="container">
			<div class="row">
				<div class="col-sm-12 col-md-6 col-lg-6 px-xl-3">
					<div class="promo-img">
						<a href="javascript:void(0);"><img src="images/promo/home/01.jpg" alt="promo" /></a>
					</div>
				</div>
				<div class="col-sm-12 col-md-6 col-lg-6 px-xl-3">
					<div class="promo-img">
						<a href="javascript:void(0);"><img src="images/promo/home/02.jpg" alt="promo" /></a>
					</div>
				</div>
			</div>
		</div>
	</div>


	<section class="section testimonial-part">
		<div class="container">
			<div class="row">
				<div class="col-12">
					<div class="section-heading">
						<h2>phản hồi của khách hàng</h2>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<div class="testimonial-slider slider-arrow">
						<div th:each="comment : ${lastestComments}" class="testimonial-card">
							<i class="fas fa-quote-left"></i>
							<p th:text="${comment.content}"></p>
							<h5 th:text="${comment.name}"></h5>

							<ul>
								<!-- Lặp qua sao đánh giá -->
								<li th:each="i : ${#numbers.sequence(1, 5)}"
									th:classappend="${i <= comment.rating ? 'fas fa-star' : 'far fa-star'}"></li>
							</ul>

							<img th:src="@{images/avatar/{avatar}(avatar=${comment.avatar})}" alt="testimonial" />
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="news-part" style="background: url(images/newsletter.jpg) no-repeat center">
		<div class="container">
			<div class="row align-items-center">
				<div class="col-md-5 col-lg-6 col-xl-7">
					<div class="news-text">
						<h2>Nhận Nhiều Ưu Đãi Cho Người Mới Đăng Ký</h2>
						<p>Nhận Nhiều Ưu Đãi Cho Người Mới Đăng Ký</p>
					</div>
				</div>
				<div class="col-md-7 col-lg-6 col-xl-5">
					<form class="news-form">
						<input type="text" placeholder="Nhập Địa Chỉ Email Của Bạn" />
						<button>
							<span><i class="icofont-ui-email"></i>Gửi</span>
						</button>
					</form>
				</div>
			</div>
		</div>
	</section>
	<section class="intro-part">
		<div class="container">
			<div class="row intro-content">
				<div class="col-sm-6 col-lg-3">
					<div class="intro-wrap">
						<div class="intro-icon">
							<i class="fas fa-truck"></i>
						</div>
						<div class="intro-content">
							<h5>Giao Hàng Tận Nhà Miễn Phí</h5>
							<p>Giao hàng nhanh chóng, đảm bảo chất lượng hàng còn tươi.</p>
						</div>
					</div>
				</div>
				<div class="col-sm-6 col-lg-3">
					<div class="intro-wrap">
						<div class="intro-icon">
							<i class="fas fa-sync-alt"></i>
						</div>
						<div class="intro-content">
							<h5>Chính Sách Hoàn Trả</h5>
							<p>Nếu có bất kỳ dấu hiệu nào của sản phẩm bị hỏng, không còn tươi, chúng tôi cam kết hoàn
								trả 100%.</p>
						</div>
					</div>
				</div>
				<div class="col-sm-6 col-lg-3">
					<div class="intro-wrap">
						<div class="intro-icon">
							<i class="fas fa-headset"></i>
						</div>
						<div class="intro-content">
							<h5>Hệ Thống Hỗ Trợ</h5>
							<p>Nhân viên hỗ trợ nhanh chóng, nhiệt tình, hotline 24/24.</p>
						</div>
					</div>
				</div>
				<div class="col-sm-6 col-lg-3">
					<div class="intro-wrap">
						<div class="intro-icon">
							<i class="fas fa-lock"></i>
						</div>
						<div class="intro-content">
							<h5>Cách Thanh Toán An Toàn</h5>
							<p>Thanh toán tiện lợi với hình thức trực tuyến hoặc nhận hàng tận tay rồi thanh toán.</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<!--************************************
				Footer Start
		*************************************-->
	<footer th:replace="~{/web/fragments/footer :: footer}"></footer>

	<!--************************************
				Footer End
		*************************************-->

	<script src="vendor/bootstrap/jquery-1.12.4.min.js"></script>
	<script src="vendor/bootstrap/popper.min.js"></script>
	<script src="vendor/bootstrap/bootstrap.min.js"></script>
	<script src="vendor/countdown/countdown.min.js"></script>
	<script src="vendor/niceselect/nice-select.min.js"></script>
	<script src="vendor/slickslider/slick.min.js"></script>
	<script src="vendor/venobox/venobox.min.js"></script>
	<script src="js/nice-select.js"></script>
	<script src="js/countdown.js"></script>
	<script src="js/accordion.js"></script>
	<script src="js/venobox.js"></script>
	<script src="js/slick.js"></script>
	<script src="js/main.js"></script>
</body>

</html>